(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{319:function(t,a,s){"use strict";s.r(a);var r=s(38),e=Object(r.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"基于-springboot-支付系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于-springboot-支付系统","aria-hidden":"true"}},[t._v("#")]),t._v(" 基于 SpringBoot 支付系统")]),t._v(" "),s("p",[t._v("微信支付")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("应用")]),t._v(" "),s("th",[t._v("平台")]),t._v(" "),s("th",[t._v("地址")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("公众号")]),t._v(" "),s("td",[t._v("微信开发平台")]),t._v(" "),s("td",[t._v("https://mp.weixin.qq.com")])]),t._v(" "),s("tr",[s("td",[t._v("小程序")]),t._v(" "),s("td",[t._v("微信开发平台")]),t._v(" "),s("td",[t._v("https://mp.weixin.qq.com")])]),t._v(" "),s("tr",[s("td",[t._v("移动应用")]),t._v(" "),s("td",[t._v("微信开发平台")]),t._v(" "),s("td",[t._v("https://open.weixin.qq.com")])])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("产品")]),t._v(" "),s("th",[t._v("小程序 AppID")]),t._v(" "),s("th",[t._v("公众号 AppID")]),t._v(" "),s("th",[t._v("移动应用 AppID")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("公众号支付（JSAPI）")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("有")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("付款码支付")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("有")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("Native支付")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("有")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("APP 支付")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("有")])]),t._v(" "),s("tr",[s("td",[t._v("H5支付")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("有")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("小程序支付（JSAPI）")]),t._v(" "),s("td",[t._v("有")]),t._v(" "),s("td"),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("人脸支付")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td")])])]),t._v(" "),s("h2",{attrs:{id:"支付的同步与异步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#支付的同步与异步","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付的同步与异步")]),t._v(" "),s("p",[t._v("同步：直接回应")]),t._v(" "),s("p",[t._v("异步：不会立即得到响应， MQ 消息队列来做异步通知")]),t._v(" "),s("p",[t._v("建行张三 -> 网联 -> 农行李四 「request」")]),t._v(" "),s("p",[t._v("支付的结果，都是以异步为准。")]),t._v(" "),s("h2",{attrs:{id:"支付规划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#支付规划","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付规划")]),t._v(" "),s("p",[t._v("独立的系统，专属数据库、表。")]),t._v(" "),s("p",[t._v("公用属性，统一配置，统一调用")]),t._v(" "),s("h2",{attrs:{id:"微信支付流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微信支付流程","aria-hidden":"true"}},[t._v("#")]),t._v(" 微信支付流程")]),t._v(" "),s("p",[t._v("SDK: best-pay-sdk")]),t._v(" "),s("p",[t._v("以 Native 支付为例：上面表中，Native 支付是公众号支付，需要的参数如下：")]),t._v(" "),s("ul",[s("li",[t._v("公众号 AppId")]),t._v(" "),s("li",[t._v("商户号Id")]),t._v(" "),s("li",[t._v("商户号密钥")]),t._v(" "),s("li",[t._v("回调地址，由于采用方式二方式，对于回调函数没有过多的限制")])]),t._v(" "),s("p",[t._v("我们采用方式二支付 "),s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=6_5",target:"_blank",rel:"noopener noreferrer"}},[t._v("方式二支付文档地址"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("支付文档入口"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("最终填写订单号+金额，即可以出发支付请求。返回支付 URL，生成 二维码即可")]),t._v(" "),s("blockquote",[s("p",[t._v("微信支付结果异步通知")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("// 1. 签名校验\n\n// 2. 金额校验（数据库里查订单）\n\n// 3. 修改订单支付状态\n\n// 4. 通知微信，不需要在通知了\n")])])]),s("h2",{attrs:{id:"支付宝支付"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#支付宝支付","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付宝支付")]),t._v(" "),s("blockquote",[s("p",[t._v("商户应用私钥 （开发者生成）JAVA 开发需要 支付请求发起")])]),t._v(" "),s("blockquote",[s("p",[t._v("商户应用公钥（开发者生成）")])]),t._v(" "),s("blockquote",[s("p",[t._v("支付宝公钥（支付宝提供） JAVA 开发需要 支付会结果回调")])]),t._v(" "),s("blockquote",[s("p",[t._v("支付宝私钥（看不到）")])]),t._v(" "),s("p",[t._v("RSA 非对称加密：公钥私钥是一对")]),t._v(" "),s("p",[t._v("发起支付的过程：商户 -> 签名（商户应用私钥） -> 请求支付宝 -> 商户通过（商户应用公钥）验证签名")]),t._v(" "),s("blockquote",[s("p",[t._v("异步通知")])]),t._v(" "),s("p",[t._v("支付宝（支付宝私钥）-> 商户（支付宝公钥验证签名）")]),t._v(" "),s("blockquote",[s("p",[t._v("RSA 签名 不等同于加密")])]),t._v(" "),s("p",[t._v("通常是用 AES 加密解密")]),t._v(" "),s("h2",{attrs:{id:"支付地址记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#支付地址记录","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付地址记录")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 微信支付")]),t._v("\nhttp"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("p8h3t5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("natappfree"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pay"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("create"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("orderId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("ss4172020041720210400"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("amount"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("payType"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("WXPAY_NATIVE\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 支付宝支付")]),t._v("\nhttp"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("p8h3t5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("natappfree"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pay"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("create"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("orderId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("ss4172020041720210400"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("amount"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("payType"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ALIPAY_PC\n")])])]),s("p",[t._v("大公司 修改数据库 格式的时候，需要 SQL 操作的，不能随便数据库软件添加，为何？")]),t._v(" "),s("p",[t._v("因为使用例如 Navicate 等软件修改表结构，是不会有记录的，不利于追踪数据库的修改记录，查错，理解")]),t._v(" "),s("p",[t._v("应该有一个专门记录数据库的修改记录的地方，每次的修改数据库结构，都应该记录在他SQL文档当中, 今后初始化项目时 ，也可以直接直接 SQL 文档初始化。保证了线上环境与本地文档的高度统一。这才是数据库维护的标准")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" mall_pay_info "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add")]),t._v(" pay_amount "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("decimal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'支付金额'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("after")]),t._v(" platform_status\n")])])]),s("p",[t._v("Mybatis-generator 一般也是需要独立部署的，而不是跟线上业务部署在一起，这样可以避免生成的代码替换掉已经的代码，产升不必要的风险，")]),t._v(" "),s("p",[t._v("业务系统   支付系统  支付平台")]),t._v(" "),s("p",[t._v("发起第二次支付前，把上一次的支付订单关闭，调用支付平台的 API")]),t._v(" "),s("p",[t._v("ajax --\x3e api(通过订单号查询支付)")]),t._v(" "),s("p",[t._v("已支付 -> 跳转")])])},[],!1,null,null,null);a.default=e.exports}}]);