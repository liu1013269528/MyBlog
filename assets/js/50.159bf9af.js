(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{294:function(t,a,s){"use strict";s.r(a);var n=s(38),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"关于微信支付"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于微信支付","aria-hidden":"true"}},[t._v("#")]),t._v(" 关于微信支付")]),t._v(" "),s("h4",{attrs:{id:"写在前面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#写在前面","aria-hidden":"true"}},[t._v("#")]),t._v(" 写在前面")]),t._v(" "),s("p",[t._v("微信支付的一些记录，主要是针对于 微信退款 功能。后续有时间补全其他")]),t._v(" "),s("h2",{attrs:{id:"微信账户类型分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微信账户类型分类","aria-hidden":"true"}},[t._v("#")]),t._v(" 微信账户类型分类")]),t._v(" "),s("ul",[s("li",[t._v("普通商户版")]),t._v(" "),s("li",[t._v("服务商版")]),t._v(" "),s("li",[t._v("银行服务商版")])]),t._v(" "),s("p",[t._v("我主要使用过 普通商户 和 服务商商户，他们之间是有区别的，例如 普通商户只是一个独立的商户，而 服务商则是一个集合，分管很多个普通商户，所有在做微信支付相关功能是的接口参数也是有不同。主要是：sub_appid【子商户公众账号ID】 和 sub_mch_id【子商户号】")]),t._v(" "),s("h3",{attrs:{id:"服务商理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务商理解","aria-hidden":"true"}},[t._v("#")]),t._v(" 服务商理解")]),t._v(" "),s("p",[t._v("服务商，可以管理一批普通商户，然后这一需要一套支付证书即服务商证书即可，只是在做支付退款等功能，参数传入 sub_appid（ 非必需）和 sub_mch_id（必须）就可以对服务商下子商户进行支付和退款等相关的操作。")]),t._v(" "),s("h2",{attrs:{id:"爬坑："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#爬坑：","aria-hidden":"true"}},[t._v("#")]),t._v(" 爬坑：")]),t._v(" "),s("blockquote",[s("p",[t._v("微信提供的 demo 本身是不支持 服务商的，需要自己修改类库源码")])]),t._v(" "),s("p",[t._v("微信提供的支付PHP类库主要有：")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[t._v("WxPay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php "),s("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[t._v("# 主要的接口操作")]),t._v("\nWxPay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Interface")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php "),s("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[t._v("# 配置信息的接口模板")]),t._v("\nWxPay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php "),s("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[t._v("# 主要支付账户信息的配置，例如：APPID、MCHID：商户号 等。")]),t._v("\nWxPay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php "),s("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[t._v("# 接口提交的数据结构体。")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[t._v("# 可以这样理解类库操作")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$config")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WxPayConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[t._v("# 获取微信账户配置信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$input")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WxPayRefund")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[t._v("# 获取需要支付提交的数据。")]),t._v("\nWxPayApi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("refund")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$input")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[t._v("# 注意：在做子商户信息提交时，我在 WxPayRefund 添加 SetSubMch_id 方法，即为 SetSubMch_id protected 属性 插入新的参数：sub_mch_id。")]),t._v("\n")])])]),s("h2",{attrs:{id:"我遇到的错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#我遇到的错误","aria-hidden":"true"}},[t._v("#")]),t._v(" 我遇到的错误")]),t._v(" "),s("blockquote",[s("p",[t._v("58 错误")])]),t._v(" "),s("p",[t._v("是因为 SSL 证书的路径错误，我之前用了 http 地址，这是不对的。需要使用服务器的绝对路径。")]),t._v(" "),s("blockquote",[s("p",[t._v("60 错误")])]),t._v(" "),s("p",[t._v("通常是 SSL 证书严格校验导致")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在 WxPay.Api.php 中做如下修改")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,TRUE);")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,2);//严格校验")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_SSL_VERIFYPEER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean constant"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CURLOPT_SSL_VERIFYHOST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean constant"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//严格校验")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("0参数格式错误")])]),t._v(" "),s("p",[t._v("API 请求成功了，但是返回的是 return_code: FAIL，return_msg: 0参数格式错误.")]),t._v(" "),s("p",[t._v("我的原因是：不小心把金额写错成了 浮点数。接口的金额单位是：分，整型。")]),t._v(" "),s("blockquote",[s("p",[t._v("基本账户余额不足，请充值后重新发起")])]),t._v(" "),s("p",[t._v("这个问题是因为微信支付是需要扣手续费的，到时原金额退款时，账户金额不足导致的。走到这一步就说明你的程序已经没有问题了。剩下就是子商户资金管理相关的。")])])},[],!1,null,null,null);a.default=e.exports}}]);